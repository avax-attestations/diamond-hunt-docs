<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Architecture - Diamond Hunt Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Diamond Hunt Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">About</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Architecture</a>
                            </li>
                            <li class="nav-item">
                                <a href="../attestations/" class="nav-link">Attestations</a>
                            </li>
                            <li class="nav-item">
                                <a href="../deployment/" class="nav-link">Deployment</a>
                            </li>
                            <li class="nav-item">
                                <a href="../contracts/" class="nav-link">Contracts</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../attestations/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#architecture" class="nav-link">Architecture</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#components" class="nav-link">Components</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#diamond-token" class="nav-link">Diamond Token</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#proxy" class="nav-link">Proxy</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#rewarders" class="nav-link">Rewarders</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#web-app" class="nav-link">Web App</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="architecture">Architecture</h1>
<p>The user flow from perspective a user visiting a site and receiving an attestation.</p>
<p><img alt="Attestation Flow" src="../sequence-diagram.png" title="Title" /></p>
<h2 id="components">Components</h2>
<p>A description of the main components of the diamond hunt app, familiarity with EAS service is assumed.</p>
<h2 id="diamond-token">Diamond Token</h2>
<p>The Diamond token is a modified ERC20 with transfer functionality disabled. The
proxy is the sole account that can mint and burn tokens, it can burn tokens for
any holder without prior approval. A users diamond balance is a measure of
trusted they are based on attestations they have received.</p>
<h2 id="proxy">Proxy</h2>
<p>The proxy contract is the sole address that attests as part of the diamond hunt
application. All attestations made by this address are valid diamond hunt
attestations. The proxy serves multiple purposes with the core 3 being:</p>
<ol>
<li>Verifies signatures of attestations have been generated by a trusted address</li>
<li>Attests with AAS with enabled schemas</li>
<li>Mints/burns diamond tokens to recipients</li>
</ol>
<p>The proxy has a state variable <code>attester</code>, all attestations sent to the proxy
must contain a valid signature from this account. This account can be updated
with the <code>updateAttester</code> function.</p>
<p>Schemas need to be enabled in the proxy (by the owner) before it will attest to
them. To do this the <code>addAttestationType</code> function needs to be called with the
following parameters:</p>
<ul>
<li>id (string which serves as the name)</li>
<li>schema (bytes32 referencing an EAS schema ID)</li>
<li>rewarder (address for a rewarder contract)</li>
</ul>
<p>After the proxy attests it mints diamond tokens to the attestation recipient
according the a value returned by the rewarder.</p>
<h2 id="rewarders">Rewarders</h2>
<p>Rewarders are simple contracts with a single public function <code>rewardFor</code>. This
function receives encoded attestation data (decode with <code>abi.decode</code>) and
returns a <em>uint256</em> amount which indicates how many diamonds to mint.</p>
<p>There are two included rewarders that return a constant amount and a variable
amount based on a value in the attestation.</p>
<h2 id="web-app">Web App</h2>
<p>The web application is responsible for:</p>
<ol>
<li>Verifying a user meets the criteria for receiving at attestation</li>
<li>Populating attestation data and signing attestation</li>
</ol>
<p>The methods to verify criteria for an attestation is open ended and coded with
typescript. Some implemented methods involve:</p>
<ul>
<li>Reading a list of addresses from a CSV  (diamond hands)</li>
<li>Querying an external API (joepegs, dex api)</li>
<li>Performing authentication with an external service (twitter)</li>
<li>Checking a signature is valid (referral system)</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
